# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## üéØ Project Context

**Zambia** - Angular 19 + Nx monorepo for managing Akademia's multi-country educational organization.

### Tech Stack at a Glance

- **Frontend**: Angular 19 (standalone components, signals, new control flow)
- **Build**: Nx 20 monorepo
- **Backend**: Supabase (PostgreSQL + Auth)
- **UI**: TaigaUI + Tailwind CSS
- **i18n**: ngx-translate (EN/ES)

## üèóÔ∏è Architecture Quick Reference

```
apps/
‚îú‚îÄ‚îÄ zambia/          # Main app
‚îî‚îÄ‚îÄ zambia-e2e/      # E2E tests

libs/
‚îú‚îÄ‚îÄ shared/          # Cross-app libraries
‚îÇ   ‚îú‚îÄ‚îÄ data-access-*    # Services & API
‚îÇ   ‚îú‚îÄ‚îÄ ui-components/   # Reusable UI
‚îÇ   ‚îú‚îÄ‚îÄ util-*          # Utilities
‚îÇ   ‚îî‚îÄ‚îÄ types-*         # TypeScript types
‚îî‚îÄ‚îÄ zambia/          # Feature modules
    ‚îî‚îÄ‚îÄ feat-*       # Feature-specific
```

### Naming Conventions

- **Components**: `*.smart-component.ts` (containers) | `*.ui-component.ts` (presentational)
- **Services**: Inject with `inject()`, not constructors
- **Files**: kebab-case, descriptive names

## üöÄ Essential Commands

```bash
# Development
npm run dev                              # Start dev server
npm run build                           # Build app
npm run lint:all                        # Lint everything
npm test                               # Run tests

# Code Generation
npx nx g @nx/angular:library --name=feat-[name] --tags=scope:zambia,type:feat --directory=libs/zambia/feat-[name]
npx nx g @nx/angular:component --path=[path] --name=[name] --type=smart-component --changeDetection=OnPush --inlineStyle=true --inlineTemplate=true

# Git & Quality
npm run cm                             # Commitizen (standardized commits)
npm run prettier:staged                # Format staged files
```

## üìã Angular 19 Patterns

### ‚úÖ ALWAYS Use

```typescript
// Dependency Injection
private authService = inject(AuthService);

// Signals
isLoading = signal(false);
filteredItems = computed(() => this.items().filter(item => item.active));

// Control Flow in Templates
@if (condition) { <div>Content</div> }
@for (item of items; track item.id) { <div>{{item.name}}</div> }
@switch

// Inputs/Outputs
data = input.required<Data>();
itemSelected = output<Item>();
import {model} from '@angular/core`;
firstName = model<string>();            // ModelSignal<string|undefined>
//  model declares a writeable signal that is exposed as an input/output pair on the containing directive.
  //  The input name is taken either from the class member or from the alias option. The output name is generated by taking the input name and appending Change.
```

### ‚ùå NEVER Use

```typescript
// Constructor injection
constructor(private service: Service) {}

// Old directives
*ngIf, *ngFor, *ngSwitch

// NgModules
@NgModule({...})
```

## üîê RBAC System

### Current Implementation

- **Auth**: Supabase with role in user metadata
- **Services**: `AuthService` ‚Üí `RoleService`
- **Guards**: `authGuard`, `roleGuard`
- **Config**: Navigation in `ROLES_CONSTANTS.ts`

### Role Structure

```typescript
ROLE_GROUPS = {
  ADMINISTRATION: ['superadmin'],
  TOP_MANAGEMENT: ['general_director', 'executive_leader'],
  LEADERSHIP_TEAM: [...],
  HEADQUARTERS_MANAGEMENT: [...]
}
```

### Adding Features

1. Add to `NAVIGATION_CONFIG` in `ROLES_CONSTANTS.ts`
2. Add to `NAVIGATION_SECTIONS`
3. Add translations to `i18n/*.json`
4. Add route with `roleGuard`

## üõ†Ô∏è Common Tasks

### Add New Feature Module

```bash
# 1. Generate library
npx nx g @nx/angular:library --name=feat-example --tags=scope:zambia,type:feat --directory=libs/zambia/feat-example

# 2. Generate smart component
npx nx g @nx/angular:component --path=libs/zambia/feat-example/src/lib/components/smart --name=example --type=smart-component --changeDetection=OnPush --inlineStyle=true --inlineTemplate=true

# 3. Add navigation (see RBAC section)
```

### Fix Common Issues

**ESLint Config Error**

```json
// Add to tsconfig.app.json
"include": ["src/**/*.d.ts", "src/environments/*.ts", "set-env.ts"]
```

**Import Paths**

```typescript
// Use @zambia/* paths
import { AuthService } from '@zambia/data-access-auth';
```

## üìê Code Style Rules

1. **Components**: OnPush change detection, standalone only
2. **Templates**: New control flow syntax (@if, @for)
3. **State**: Signals over observables for local state
4. **Services**: Single responsibility, use facades for complex logic
5. **Testing**: Behavior over implementation

## üé® UI Guidelines

### Core Stack

- **Framework**: TaigaUI components + Tailwind CSS v4
- **Fonts**: Source Sans Pro (primary), Source Serif Pro (highlights)
- **Theme**: Dark/light mode with `ThemeService` + custom TaigaUI overrides
- **Icons**: Lucide icons via TUI

### Color System

- **Primary**: Sky (blue) - `bg-sky-600` light / `bg-sky-500` dark
- **Success**: Emerald - `bg-emerald-600` light / `bg-emerald-500` dark
- **Backgrounds**:
  - Light: `bg-white`, `bg-gray-50`
  - Dark: `dark:bg-slate-800`, `dark:bg-slate-900`
- **Cards**: Always include shadow + dark mode variants

### Component Patterns

```html
<!-- Card Example -->
<div class="rounded-lg bg-white p-6 shadow-md dark:bg-slate-800 dark:shadow-gray-900/30">
  <h2 class="text-xl font-semibold text-gray-800 dark:text-white">Title</h2>
  <p class="text-gray-600 dark:text-gray-300">Content</p>
</div>

<!-- Interactive Action Card -->
<button
  class="group relative overflow-hidden rounded-xl bg-white p-6 text-left shadow-sm transition-all duration-200 hover:shadow-lg hover:shadow-blue-500/10 dark:bg-slate-800"
>
  <div class="flex items-center gap-4">
    <div class="rounded-lg bg-gradient-to-r from-blue-500 to-blue-600 p-3">
      <svg class="h-6 w-6 text-white"><!-- icon --></svg>
    </div>
    <div>
      <h3 class="font-semibold text-gray-900 dark:text-white">Title</h3>
      <p class="text-sm text-gray-600 dark:text-gray-300">Description</p>
    </div>
  </div>
</button>
```

### Spacing & Layout

- **Page sections**: `px-6 py-8 sm:px-8`
- **Cards**: `p-4` or `p-6` with `rounded-lg`
- **Form groups**: `space-y-4`
- **Grid responsive**: `grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4`

### Typography Scale

- **H1**: `text-2xl font-bold` / `text-3xl sm:text-4xl` (hero)
- **H2**: `text-xl font-semibold`
- **H3**: `text-lg font-semibold`
- **Body**: Base size (no class)
- **Small**: `text-sm`
- **Stats**: `text-2xl font-bold`

### Key CSS Variables (in styles.css)

- Primary accent: `--tui-background-accent-1`
- Text colors: `--tui-text-primary`, `--tui-text-secondary`
- Status colors: `--tui-status-positive`, `--tui-status-negative`
- Custom scrollbar styling included

### Best Practices

1. **Always** include dark mode classes
2. **Use** gradient backgrounds for interactive elements
3. **Apply** consistent shadows with color tinting on hover
4. **Test** in both themes before committing
5. **Follow** mobile-first responsive design

### Form Styling

- **TUI Components**: Use TaigaUI form controls
- **Focus states**: Handled by TUI with sky-600 accent
- **Validation**: Use TUI error states with status colors

## üìö Key Services

### Core Services

- `AuthService` - Authentication state
- `RoleService` - Role checks & navigation
- `SupabaseService` - Database connection
- `ThemeService` - Theme management
- `NotificationService` - User notifications

### Feature Services

- `CountriesFacadeService` - Countries management
- `HeadquartersFacadeService` - HQ operations
- `WorkshopsFacadeService` - Workshop scheduling
- `AgreementsFacadeService` - Agreement tracking

## üîç Quick Debugging

```bash
# Check circular dependencies
npx nx graph

# Analyze bundle size
npx nx build zambia --stats-json
npx webpack-bundle-analyzer dist/apps/zambia/stats.json

# Clear cache if weird errors
npx nx reset
```

## ü§ñ AI Integration (Nx MCP)

**Nx MCP Server** provides deep workspace context to AI assistants:

```bash
# Enable MCP for enhanced AI capabilities
npx nx-mcp@latest /home/mcpo/developer/zambia

# Available AI tools via MCP:
# - nx_workspace: Project graph and configuration
# - nx_project_details: Specific project info
# - nx_docs: Contextual Nx documentation
# - nx_generators: Available code generators
# - nx_visualize_graph: Interactive project graphs
```

**Enhanced AI Capabilities:**

- Impact analysis across projects
- Architecture-aware code generation
- Workspace pattern recognition
- Smart generator suggestions

## üìñ Documentation

- **Angular Guidelines**: [`docs/ANGULAR_GUIDELINES.md`](docs/ANGULAR_GUIDELINES.md)
- **Development**: [`docs/DEVELOPMENT.md`](docs/DEVELOPMENT.md)
- **Database Schema**: [`docs/DATABASE.md`](docs/DATABASE.md)
- **Nx MCP Integration**: [`docs/NX_MCP.md`](docs/NX_MCP.md)

## ‚ö° Performance Tips

1. Use `@defer` for heavy components
2. TrackBy functions in @for loops
3. OnPush change detection everywhere
4. Lazy load feature modules
5. Use computed() for derived state

## üîÑ Git Workflow

### **Commit Standards**

- **Types**: feat, fix, docs, style, refactor, perf, test, chore, ci, build
- **Always commit** completed work with semantic messages
- **NEVER push** unless explicitly requested by user
- **Include** detailed bullet points explaining changes

### **Commit Message Format**

```
type(scope): brief description

- Detailed explanation of changes and their impact
- Focus on the "why" rather than the "what"
- Include motivation and reasoning behind changes

ü§ñ Generated with [Claude Code](https://claude.ai/code)

Co-Authored-By: Claude <noreply@anthropic.com>
```

### **Workflow Steps**

1. Make and test changes
2. Run linting/type checking if needed
3. Stage files with `git add`
4. Commit with semantic message
5. **Wait for user instruction** before any `git push`

## üö® Critical Rules

1. **NEVER** commit secrets or API keys
2. **NEVER** push to remote without explicit user request
3. **ALWAYS** use type safety (no `any`)
4. **FOLLOW** existing patterns in codebase
5. **TEST** before committing
6. **USE** semantic commit messages

---

**Remember**: When in doubt, check existing code patterns in the codebase first!
