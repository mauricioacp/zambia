# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## üéØ Project Context

**Zambia** - Angular 19 + Nx monorepo for managing Akademia's multi-country educational organization.

### Tech Stack at a Glance

- **Frontend**: Angular 19 (standalone components, signals, new control flow)
- **Build**: Nx 20 monorepo
- **Backend**: Supabase (PostgreSQL + Auth)
- **UI**: TaigaUI + Tailwind CSS
- **i18n**: ngx-translate (EN/ES)

## üèóÔ∏è Architecture Quick Reference

```
apps/
‚îú‚îÄ‚îÄ zambia/          # Main app
‚îî‚îÄ‚îÄ zambia-e2e/      # E2E tests

libs/
‚îú‚îÄ‚îÄ shared/          # Cross-app libraries
‚îÇ   ‚îú‚îÄ‚îÄ data-access-*    # Services & API
‚îÇ   ‚îú‚îÄ‚îÄ ui-components/   # Reusable UI
‚îÇ   ‚îú‚îÄ‚îÄ util-*          # Utilities
‚îÇ   ‚îî‚îÄ‚îÄ types-*         # TypeScript types
‚îî‚îÄ‚îÄ zambia/          # Feature modules
    ‚îî‚îÄ‚îÄ feat-*       # Feature-specific
```

### Naming Conventions

- **Components**: `*.smart-component.ts` (containers) | `*.ui-component.ts` (presentational)
- **Services**: Inject with `inject()`, not constructors
- **Files**: kebab-case, descriptive names

## üöÄ Essential Commands

```bash
# Development
npm run dev                              # Start dev server
npm run build                           # Build app
npm run lint:all                        # Lint everything
npm test                               # Run tests

# Code Generation
npx nx g @nx/angular:library --name=feat-[name] --tags=scope:zambia,type:feat --directory=libs/zambia/feat-[name]
npx nx g @nx/angular:component --path=[path] --name=[name] --type=smart-component --changeDetection=OnPush --inlineStyle=true --inlineTemplate=true

# Git & Quality
npm run cm                             # Commitizen (standardized commits)
npm run prettier:staged                # Format staged files
```

## üìã Angular 19 Patterns

### ‚úÖ ALWAYS Use

```typescript
// Dependency Injection
private authService = inject(AuthService);

// Signals
isLoading = signal(false);
filteredItems = computed(() => this.items().filter(item => item.active));

// Control Flow in Templates
@if (condition) { <div>Content</div> }
@for (item of items; track item.id) { <div>{{item.name}}</div> }
@switch

// Inputs/Outputs
data = input.required<Data>();
itemSelected = output<Item>();
import {model} from '@angular/core`;
firstName = model<string>();            // ModelSignal<string|undefined>
//  model declares a writeable signal that is exposed as an input/output pair on the containing directive.
  //  The input name is taken either from the class member or from the alias option. The output name is generated by taking the input name and appending Change.
```

### ‚ùå NEVER Use

```typescript
// Constructor injection
constructor(private service: Service) {}

// Old directives
*ngIf, *ngFor, *ngSwitch

// NgModules
@NgModule({...})
```

## üîê RBAC System

### Current Implementation

- **Auth**: Supabase with role in user metadata
- **Services**: `AuthService` ‚Üí `RoleService`
- **Guards**: `authGuard`, `roleGuard`
- **Config**: Navigation in `ROLES_CONSTANTS.ts`

### Role Structure

```typescript
ROLE_GROUPS = {
  ADMINISTRATION: ['superadmin'],
  TOP_MANAGEMENT: ['general_director', 'executive_leader'],
  LEADERSHIP_TEAM: [...],
  HEADQUARTERS_MANAGEMENT: [...]
}
```

### Adding Features

1. Add to `NAVIGATION_CONFIG` in `ROLES_CONSTANTS.ts`
2. Add to `NAVIGATION_SECTIONS`
3. Add translations to `i18n/*.json`
4. Add route with `roleGuard`

## üõ†Ô∏è Common Tasks

### Add New Feature Module

```bash
# 1. Generate library
npx nx g @nx/angular:library --name=feat-example --tags=scope:zambia,type:feat --directory=libs/zambia/feat-example

# 2. Generate smart component
npx nx g @nx/angular:component --path=libs/zambia/feat-example/src/lib/components/smart --name=example --type=smart-component --changeDetection=OnPush --inlineStyle=true --inlineTemplate=true

# 3. Add navigation (see RBAC section)
```

### Fix Common Issues

**ESLint Config Error**

```json
// Add to tsconfig.app.json
"include": ["src/**/*.d.ts", "src/environments/*.ts", "set-env.ts"]
```

**Import Paths**

```typescript
// Use @zambia/* paths
import { AuthService } from '@zambia/data-access-auth';
```

## üìê Code Style Rules

1. **Components**: OnPush change detection, standalone only
2. **Templates**: New control flow syntax (@if, @for)
3. **State**: Signals over observables for local state
4. **Services**: Single responsibility, use facades for complex logic
5. **Testing**: Behavior over implementation

## üé® UI Guidelines

- **Framework**: TaigaUI components + Tailwind utilities
- **Theme**: Dark/light mode with `ThemeService`
- **Layout**: Sidebar navigation, card-based content
- **Tables**: Use `GenericTableUiComponent` for data display
- **Forms**: Reactive forms with TUI form controls

## üìö Key Services

### Core Services

- `AuthService` - Authentication state
- `RoleService` - Role checks & navigation
- `SupabaseService` - Database connection
- `ThemeService` - Theme management
- `NotificationService` - User notifications

### Feature Services

- `CountriesFacadeService` - Countries management
- `HeadquartersFacadeService` - HQ operations
- `WorkshopsFacadeService` - Workshop scheduling
- `AgreementsFacadeService` - Agreement tracking

## üîç Quick Debugging

```bash
# Check circular dependencies
npx nx graph

# Analyze bundle size
npx nx build zambia --stats-json
npx webpack-bundle-analyzer dist/apps/zambia/stats.json

# Clear cache if weird errors
npx nx reset
```

## üìñ Documentation

- **Angular Guidelines**: [`docs/ANGULAR_GUIDELINES.md`](docs/ANGULAR_GUIDELINES.md)
- **Development**: [`docs/DEVELOPMENT.md`](docs/DEVELOPMENT.md)
- **Database Schema**: [`docs/DATABASE.md`](docs/DATABASE.md)

## ‚ö° Performance Tips

1. Use `@defer` for heavy components
2. TrackBy functions in @for loops
3. OnPush change detection everywhere
4. Lazy load feature modules
5. Use computed() for derived state

## üö® Critical Rules

1. **NEVER** commit secrets or API keys
2. **ALWAYS** use type safety (no `any`)
3. **FOLLOW** existing patterns in codebase
4. **TEST** before committing
5. **USE** semantic commit messages

---

**Remember**: When in doubt, check existing code patterns in the codebase first!
